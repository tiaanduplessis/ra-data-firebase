{"version":3,"file":"ra-data-firebase.umd.js","sources":["../src/methods.js","../src/data-provider.js"],"sourcesContent":["import firebase from 'firebase'\nimport sortBy from 'sort-by'\n\nimport {\n  CREATE\n} from 'react-admin'\n\nconst getImageSize = (file) => {\n  return new Promise(resolve => {\n    const img = document.createElement('img')\n    img.onload = function () {\n      resolve({\n        width: this.width,\n        height: this.height\n      })\n    }\n    img.src = file.src\n  })\n}\n\nconst upload = async (fieldName, submitedData, id, resourceName, resourcePath) => {\n  let file = submitedData[fieldName] && Array.isArray(submitedData[fieldName]) ? submitedData[fieldName][0] : submitedData[fieldName]\n  const result = {}\n  if (file && file.rawFile && file.rawFile.name) {\n    const rawFile = file.rawFile\n    const ref = firebase.storage().ref().child(`${resourcePath}/${id}/${fieldName}`)\n    const snapshot = await ref.put(rawFile)\n    result[fieldName] = [{}]\n    result[fieldName][0].uploadedAt = Date.now()\n    result[fieldName][0].src = snapshot.downloadURL.split('?').shift() + '?alt=media'\n    result[fieldName][0].type = rawFile.type\n    if (rawFile.type.indexOf('image/') === 0) {\n      try {\n        const imageSize = await getImageSize(file)\n        result[fieldName][0].width = imageSize.width\n        result[fieldName][0].height = imageSize.height\n      } catch (e) {\n        console.error(`Failed to get image dimensions`)\n      }\n    }\n    return result\n  }\n  return false\n}\n\nconst save = async (id, data, previous, resourceName, resourcePath, firebaseSaveFilter, uploadResults, isNew, metaFieldNames) => {\n  const currentUser = firebase.auth().currentUser\n\n  if (uploadResults) {\n    uploadResults.map(uploadResult => uploadResult ? Object.assign(data, uploadResult) : false)\n  }\n\n  if (isNew) {\n    Object.assign(data, { [metaFieldNames.createdAt]: Date.now() })\n  }\n\n  if (currentUser) {\n    Object.assign(data, { [metaFieldNames.createdBy]: currentUser.uid })\n  }\n\n  data = Object.assign(previous, { [metaFieldNames.updatedAt]: Date.now() }, data)\n\n  if (!data.key) {\n    data.key = id\n  }\n  if (!data.id) {\n    data.id = id\n  }\n\n  await firebase.database().ref(`${resourcePath}/${data.key}`).update(firebaseSaveFilter(data))\n  return { data }\n}\n\nconst del = async (id, resourceName, resourcePath, uploadFields) => {\n  if (uploadFields.length) {\n    uploadFields.map(fieldName =>\n      firebase.storage().ref().child(`${resourcePath}/${id}/${fieldName}`).delete())\n  }\n\n  await firebase.database().ref(`${resourcePath}/${id}`).remove()\n  return { data: id }\n}\n\nconst getItemID = (params, type, resourceName, resourcePath, resourceData) => {\n  let itemId = params.data.id || params.id || params.data.key || params.key\n  if (!itemId) {\n    itemId = firebase.database().ref().child(resourcePath).push().key\n  }\n\n  if (!itemId) {\n    throw new Error('ID is required')\n  }\n\n  if (resourceData && resourceData[itemId] && type === CREATE) {\n    throw new Error('ID already in use')\n  }\n\n  return itemId\n}\n\nconst getOne = (params, resourceName, resourceData) => {\n  if (params.id && resourceData[params.id]) {\n    return { data: resourceData[params.id] }\n  } else {\n    throw new Error('Key not found')\n  }\n}\n\nconst getMany = (params, resourceName, resourceData) => {\n  let ids = []\n  let data = []\n  let total = 0\n\n  if (params.ids && Array.isArray(params.ids)) {\n    /** GET_MANY */\n    params.ids.forEach(key => {\n      if (resourceData[key]) {\n        ids.push(key)\n        data.push(resourceData[key])\n        total++\n      }\n    })\n\n    return {total, ids, data}\n  } else if (params.pagination) {\n    /** GET_LIST / GET_MANY_REFERENCE */\n    let values = []\n\n    // Copy the filter params so we can modify for GET_MANY_REFERENCE support.\n    const filter = Object.assign({}, params.filter)\n\n    if (params.target && params.id) {\n      filter[params.target] = params.id\n    }\n\n    const filterKeys = Object.keys(filter)\n    /* TODO Must have a better way */\n    if (filterKeys.length) {\n      Object.values(resourceData).map(value => {\n        let filterIndex = 0\n        while (filterIndex < filterKeys.length) {\n          let property = filterKeys[filterIndex]\n          if (property !== 'q' && value[property] !== filter[property]) {\n            return filterIndex\n          } else if (property === 'q') {\n            if (JSON.stringify(value).indexOf(filter['q']) === -1) {\n              return filterIndex\n            }\n          }\n          filterIndex++\n        }\n        values.push(value)\n        return filterIndex\n      })\n    } else {\n      values = Object.values(resourceData)\n    }\n\n    if (params.sort) {\n      values.sort(sortBy(`${params.sort.order === 'ASC' ? '-' : ''}${params.sort.field}`))\n    }\n\n    const keys = values.map(i => i.id)\n    const { page, perPage } = params.pagination\n    const _start = (page - 1) * perPage\n    const _end = page * perPage\n    data = values.slice(_start, _end)\n    ids = keys.slice(_start, _end)\n    total = values.length\n    return { data, ids, total }\n  } else {\n    throw new Error('Error processing request')\n  }\n}\n\nexport default {\n  upload,\n  save,\n  del,\n  getItemID,\n  getOne,\n  getMany\n}\n","import firebase from 'firebase'\nimport methods from './methods'\nimport deepAssign from 'deep-assign'\n\nimport {\n  GET_LIST,\n  GET_ONE,\n  GET_MANY,\n  GET_MANY_REFERENCE,\n  CREATE,\n  UPDATE,\n  DELETE\n} from 'react-admin'\n\nconst baseConfig = {\n  initialQuerytimeout: 10000,\n  metaFieldNames: {\n    createdAt: 'createdAt',\n    updatedAt: 'updatedAt',\n    createdBy: 'createdBy'\n  },\n  admin: {\n    path: 'users',\n    config: {},\n    validate: () => true\n  },\n  debug: false,\n  trackedResources: [],\n  firebaseSaveFilter: (data) => data,\n  firebaseGetFilter: (data) => data\n}\n\nexport default (options = {}) => {\n  options = deepAssign({}, baseConfig, methods, options)\n  const { metaFieldNames, trackedResources, initialQuerytimeout, debug, admin, firebaseSaveFilter, firebaseGetFilter, upload, save, del, getItemID, getOne, getMany } = options\n\n  const resourcesStatus = {}\n  const resourcesReferences = {}\n  const resourcesData = {}\n  const resourcesPaths = {}\n  const resourcesUploadFields = {}\n\n  // Sanitize Resources\n  trackedResources.forEach((resource, index) => {\n    if (typeof resource === 'string') {\n      resource = {\n        name: resource,\n        path: resource,\n        uploadFields: []\n      }\n      trackedResources[index] = resource\n    }\n\n    const { name, path, uploadFields } = resource\n\n    if (!name) {\n      throw new Error(`name is missing from resource ${resource}`)\n    }\n\n    resourcesUploadFields[name] = uploadFields || []\n    resourcesPaths[name] = path || name\n    resourcesData[name] = {}\n  })\n\n  const initializeResource = ({name, isPublic}, resolve) => {\n    let ref = resourcesReferences[name] = firebase.database().ref(resourcesPaths[name])\n    resourcesData[name] = []\n\n    if (isPublic) {\n      subscribeResource(ref, name, resolve)\n    } else {\n      firebase.auth().onAuthStateChanged(auth => {\n        if (auth) {\n          subscribeResource(ref, name, resolve)\n        }\n      })\n    }\n\n    setTimeout(resolve, initialQuerytimeout)\n    return true\n  }\n\n  const subscribeResource = (ref, name, resolve) => {\n    ref.once('value', function (snapshot) {\n      /** Uses \"value\" to fetch initial data. Avoid the AOR to show no results */\n      if (snapshot.key === name) {\n        const entries = snapshot.val() || {}\n        Object.keys(entries).forEach(key => {\n          resourcesData[name][key] = firebaseGetFilter(entries[key], name)\n        })\n        Object.keys(resourcesData[name]).forEach(itemKey => {\n          resourcesData[name][itemKey].id = itemKey\n          resourcesData[name][itemKey].key = itemKey\n        })\n        resolve()\n      }\n    })\n\n    ref.on('child_added', function (snapshot) {\n      resourcesData[name][snapshot.key] = firebaseGetFilter(Object.assign({}, {\n        id: snapshot.key,\n        key: snapshot.key\n      }, snapshot.val()), name)\n    })\n\n    ref.on('child_removed', function (oldsnapshot) {\n      if (resourcesData[name][oldsnapshot.key]) { delete resourcesData[name][oldsnapshot.key] }\n    })\n\n    ref.on('child_changed', function (snapshot) {\n      resourcesData[name][snapshot.key] = snapshot.val()\n    })\n  }\n\n  trackedResources.forEach(resource => {\n    resourcesStatus[resource.name] = new Promise(resolve => {\n      initializeResource(resource, resolve)\n    })\n  })\n\n  /**\n   * @param {string} type Request type, e.g GET_LIST\n   * @param {string} resourceName Resource name, e.g. \"posts\"\n   * @param {Object} payload Request parameters. Depends on the request type\n   * @returns {Promise} the Promise for a REST response\n   */\n  return async (type, resourceName, params) => {\n    debug && console.log(type, resourceName, params)\n    await resourcesStatus[resourceName]\n    let result = null\n    switch (type) {\n      case GET_LIST:\n      case GET_MANY:\n      case GET_MANY_REFERENCE:\n        result = await getMany(params, resourceName, resourcesData[resourceName])\n        return result\n\n      case GET_ONE:\n        result = await getOne(params, resourceName, resourcesData[resourceName])\n        return result\n\n      case DELETE:\n        const uploadFields = resourcesUploadFields[resourceName] ? resourcesUploadFields[resourceName] : []\n\n        result = await del(params.id, resourceName, resourcesPaths[resourceName], uploadFields)\n        return result\n\n      case UPDATE:\n      case CREATE:\n\n        let itemId\n\n        const shouldCreateUser = admin && admin.path === resourceName && type === CREATE && params.data && params.data.email && params.data.password && admin.validate(params.data)\n        if (shouldCreateUser) {\n          try {\n            const app = firebase.initializeApp(admin.config, 'user-admin')\n            const user = await app.auth().createUserWithEmailAndPassword(params.data.email, params.data.password)\n            itemId = user.uid\n            app.auth().signOut()\n          } catch (error) {\n            return Promise.reject(new Error(error))\n          }\n        } else {\n          itemId = getItemID(params, type, resourceName, resourcesPaths[resourceName], resourcesData[resourceName])\n        }\n\n        const uploads = resourcesUploadFields[resourceName]\n          ? resourcesUploadFields[resourceName]\n            .map(field => upload(field, params.data, itemId, resourceName, resourcesPaths[resourceName]))\n          : []\n\n        const currentData = resourcesData[resourceName][itemId] || {}\n        const uploadResults = await Promise.all(uploads)\n\n        result = await save(itemId, params.data, currentData, resourceName, resourcesPaths[resourceName], firebaseSaveFilter, uploadResults, type === CREATE, metaFieldNames)\n        return result\n\n      default:\n        debug && console.error('Undocumented method: ', type)\n        return { data: [] }\n    }\n  }\n}\n"],"names":["const","let","CREATE","GET_LIST","GET_MANY","GET_MANY_REFERENCE","GET_ONE","DELETE","UPDATE"],"mappings":"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"}